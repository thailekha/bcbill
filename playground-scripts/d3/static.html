<!DOCTYPE html>
<html>
<head>
  <title>D3 Network Graph</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /*circle {*/
    /*    fill: steelblue;*/
    /*    stroke: white;*/
    /*    stroke-width: 2px;*/
    /*}*/
    /*line {*/
    /*    stroke: black;*/
    /*    stroke-opacity: 1;*/
    /*}*/
    /*circle:hover {*/
    /*    stroke: black;*/
    /*}*/
    /*circle > title {*/
    /*    font-size: 20px;*/
    /*}*/
  </style>
</head>
<body>
<svg width="800" height="600"></svg>

<!--
D3 elements

<rect>: used to create rectangles
<circle>: used to create circles
<line>: used to create lines
<path>: used to create complex shapes and curves
<text>: used to create text elements
<g>: used to group elements together
<polygon>: used to create a closed shape with three or more sides
<polyline>: used to create an open shape with three or more sides
<image>: used to display an image
<ellipse>: used to create ellipses
<use>: used to reference an existing element
<symbol>: used to define reusable elements that can be reused multiple times in a document
-->

<!--
The issue with the code is that the text elements are being appended
to the rect elements which are not valid containers for text.
Instead, you should append the text elements to the same g element where
the rect elements are appended
-->

<script>
  const data = {
    nodes: [
      {id: "node1"},
      {id: "node2"},
      {id: "node3"},
      {id: "node4"},
    ],
    links: [
      {source: "node1", target: "node2"},
      {source: "node2", target: "node3"},
      {source: "node3", target: "node1"},
      {source: "node4", target: "node1"},
    ],
  };

  const svg = d3.select("svg");

  const nodeWidth = 80;
  const nodeHeight = 30;

  const simulation = d3.forceSimulation(data.nodes)
          .force("link", d3.forceLink(data.links)
                  .id(d => d.id)
                  .distance(200)
                  .strength(1)
          )
          .force("charge", d3.forceManyBody())
          .force("center", d3.forceCenter(svg.attr("width") / 2, svg.attr("height") / 2))
          .force("collide", d3.forceCollide().radius(nodeWidth / 2));


  const link = svg.append("g")
          .attr("stroke", "#999")
          .attr("stroke-opacity", 0.6)
          .selectAll("line")
          .data(data.links)
          .join("line");



  const node = svg
          .append("g")
          .selectAll("g")
          .data(data.nodes)
          .join("g")
          .attr("transform", (d) => `translate(${d.x},${d.y})`);

  node
          .append("rect")
          .attr("width", nodeWidth)
          .attr("height", nodeHeight)
          .attr("rx", 5) // rounded corners
          .attr("fill", "transparent")
          .attr("stroke", "#333")
          .attr("stroke-width", 1.5);

  node
          .append("text")
          .text((d) => d.id)
          .attr("text-anchor", "middle")
          .attr("alignment-baseline", "central")
          .attr("font-size", "12px")
          .attr("fill", "#333")
          .attr("x", nodeWidth / 2)
          .attr("y", nodeHeight / 2);

  simulation.on("tick", () => {
    link
            .attr("x1", (d) => d.source.x)
            .attr("y1", (d) => d.source.y)
            .attr("x2", (d) => d.target.x)
            .attr("y2", (d) => d.target.y);

    node.attr("transform", (d) => `translate(${d.x},${d.y})`);
  });

</script>
</body>
</html>
